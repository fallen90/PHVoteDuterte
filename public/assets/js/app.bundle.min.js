function generate(){fabric.Object.prototype.transparentCorners=!1,fabric.Image.fromURL("./img/backplate.jpg",function(t){t.scale(1).set({left:0,top:0}),canvas.add(t),fabric.Image.fromURL($("#preview").attr("src"),function(t){var e=t.width*(540/t.height);t.scale(1).set({left:0,top:0,width:e,height:540,flipX:!1}),$("[type=range]").val(0),$("[type=range]").attr("min","-"+.4*e),$("[type=range]").attr("max",0),canvas.add(t);var i=new fabric.Rect({left:10,top:86,width:360,height:365});i.setGradient("fill",{type:"linear",x1:0,y1:-360,x2:360,y2:-360,colorStops:{0:"rgba(255,255,255,0)",1:"rgba(255,255,255,0.8)"}}),fabric.Image.fromURL("./img/frontplate.jpg",function(t){t.scale(1).set({left:0,top:0}),canvas.add(t);var e=""!=$("#userName").val()?$("#userName").val():"Facebook User",i=""!=$("#userTitle").val()?$("#userTitle").val():"Duterte Supporter",a=new fabric.Textbox(e,{left:260,top:315,fontSize:24,fontFamily:"Raleway",textAlign:"center",vAlign:"center",fontWeight:600,width:260,height:58,fill:"#343434"}),n=new fabric.Textbox(i,{left:260,top:340,fontSize:15,fontFamily:"Raleway",textAlign:"center",vAlign:"center",fontWeight:400,width:260,height:58,fontStyle:"italic"});canvas.add(a),canvas.add(n);var o=canvas.toDataURL({format:"jpeg"});$("#output").attr("src",o).parent().attr("href",o)})},{crossOrigin:"Anonymous"})})}var canvas=this.__canvas=new fabric.StaticCanvas("c"),movePicture=function(t){console.log("val;m",t);var e=canvas.item(1);e.animate("left",t,{onChange:canvas.renderAll.bind(canvas)}),console.log(e)},GetUserProfile=function(){FB.getLoginStatus(function(t){console.log("FB Response",t),"connected"===t.status?(console.log("FB User Connected"),GetUserDetails(),GetUserPicture()):(console.log("FB User Login"),FB.login(function(){GetUserDetails(),GetUserPicture()},{scope:"public_profile,publish_actions"}))})},GetUserDetails=function(){FB.api("/me","GET",{fields:"id,name,work,birthday,email"},function(t){console.log("response user",t),$("#userName").val(t.name)})},GetUserPicture=function(){FB.api("/me/picture","GET",{width:512},function(t){console.log("response",t),$("#preview").attr("src",t.data.url).on("load",function(t){console.log("full loaded"),canvas.clear(),generate()})})},DownloadImage=function(){var t=canvas.toDataURL({format:"png"});downloadURI(t,"download.png")},downloadURI=function(t,e){var i=document.createElement("a");i.download=e,i.href=t,i.click()},UploadToFacebook=function(){var t=canvas.toDataURL({format:"png"});$.ajax({type:"POST",url:"/download",contentType:"application/json",data:JSON.stringify({data:t,accessToken:FB.getAccessToken()}),dataType:"json",success:function(t){console.log("response",t)}})},flip=function(){console.log("click!");var t=canvas.item(1);t.flipX=!t.flipX,t.animate("left",0,{onChange:canvas.renderAll.bind(canvas)}),$("[type=range]").val(0),t.flipX?$("#flip > img").addClass("flipped"):$("#flip > img").removeClass("flipped")},setName=function(t){var e=canvas.item(3);e.setText(t),canvas.renderAll()},setTitle=function(t){var e=canvas.item(4);e.setText(t),canvas.renderAll()};$(document).ready(function(){$("#file").on("change",function(){var t=new FileReader;t.onload=function(t){document.getElementById("preview").src=t.target.result,canvas=this.__canvas=new fabric.StaticCanvas("c"),generate()},t.readAsDataURL(this.files[0])}),$("#generate").click(function(){generate()}),$("#pickImage").click(function(t){t.preventDefault(),$("input[type=file]").trigger("click")})}),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=(e.util.object.extend,e.util.object.clone);e.util.toFixed;if(e.Textbox)return void e.warn("fabric.Textbox is already defined");if(!e.Object)return void e.warn("fabric.Textbox requires fabric.Object");var a=e.Object.prototype.stateProperties.concat(),n=["fontFamily","fontWeight","fontSize","path","text","textDecoration","textShadow","textAlign","fontStyle","lineHeight","backgroundColor","textBackgroundColor","useNative","originalText","textPadding","boxPath","vAlign","boxImageScaleX","boxImageScaleY"];a=a.concat(n),e.Textbox=e.util.createClass(e.Object,{type:"textbox",fontSize:40,fontWeight:"normal",fontFamily:"Times New Roman",textDecoration:"",textShadow:"",textAlign:"left",fontStyle:"",lineHeight:1.3,backgroundColor:"",textBackgroundColor:"",path:null,useNative:!0,stateProperties:a,originalText:"",textPadding:10,scaleTextPadding:!0,boxImage:null,boxPath:"",vAlign:"center",originalScales:null,boxImageScaleX:1,boxImageScaleY:1,textObject:null,fill:"rgba(221,204,197,0.6)",initialize:function(t,a,n){this.callSuper("initialize",a),this.setOptions(a),this.setCoords(),this.originalText=t;var o=this,s=function(a,n){var s={};if(a.length>1){var r=i(n);s=new e.PathGroup(a,r)}else s="[object Array]"===Object.prototype.toString.call(a)?a[0]:a;var c=o.get("width")/s.get("width"),h=(o.get("height")+20)/s.get("height");o.boxImageScaleX=c,o.boxImageScaleY=h,s.set({angle:0,scaleX:c,scaleY:h,hasRotatingPoint:!1,lockScalingX:!0,lockScalingY:!0,selectable:!1,useNative:!0}),s.setSourcePath(o.boxPath),s.set("_id",o._id),o.boxImage=s,l(t,n)},l=function(t,i){o.textObject=new e.Text(t,i),o.textObject.originalText=t,o._applyPropertiesToText(i),n&&n()};this.boxPath?this.boxPath.match(/svg$/)?e.loadSVGFromURL(this.boxPath,s):e.Image.fromURL(this.boxPath,s):l(t,a)},toObject:function(t){return t||(t=[]),t=t.concat(n),e.util.object.extend(this.callSuper("toObject",t))},toggle:function(t){return this.boxImage.toggle(prop),this.callSuper("toggle",prop)},getTextPadding:function(t){if(t=t?t.toLowerCase():"x",this.boxImage&&this.scaleTextPadding){var e={},i=this.originalScales;return i?(e.x=i[0],e.y=i[1]):(e.x=this.get("scaleX"),e.y=this.get("scaleY")),this.textPadding*e[t]}return this.textPadding},render:function(t,e){0!==this.width&&0!==this.height&&(t.save(),this._preRenderTransform(t,e,!1),this._render(t,e),this.active&&!e&&(this.drawBorders(t),this.drawControls(t)),t.restore(),this.boxImage&&(this._moveImageBox(t),this.boxImage.render(t,!0)),this.textObject&&(t.save(),this._preRenderTransform(t,e,!0),this._applyPropertiesToText(),this._moveText(t),this.textObject.render(t,!0),e||(this.scaleX=this.originalScales[0],this.scaleY=this.originalScales[1],this.originalScales=null),t.restore()))},_preRenderTransform:function(t,e,i){var a=this.transformMatrix;a&&!this.group&&t.setTransform(a[0],a[1],a[2],a[3],a[4],a[5]),e||(i&&(this.originalScales=[this.scaleX,this.scaleY],this.scaleX=1,this.scaleY=1),this.transform(t)),a&&this.group&&(t.translate(-this.group.width/2,-this.group.height/2),t.transform(a[0],a[1],a[2],a[3],a[4],a[5]))},_render:function(t){if(this.isActive()&&!this.boxImage){t.save();var e=-this.width/2,i=-this.height/2,a=this.width,n=this.height;t.fillStyle=this.fill.toLive?this.fill.toLive(t):this.fill,t.fillRect(e,i,a,n),t.restore()}},_moveText:function(t){this.textObject.set("text",this._wrapText(t,this.textObject.get("originalText")));var e=this.originalScales?this.originalScales[0]:this.scaleX,i=this.originalScales?this.originalScales[1]:this.scaleY,a=0,n=0;"left"==this.textAlign?a=a-this.get("width")*e/2+this.textObject.get("width")/2+this.getTextPadding("x"):"right"==this.textAlign&&(a=a+this.get("width")*e/2-this.textObject.get("width")/2-this.getTextPadding("x")),"top"==this.vAlign?n=n+(this.textObject.get("height")/2-this.get("height")*i/2)+this.getTextPadding("y"):"bottom"==this.vAlign&&(n=n-(this.textObject.get("height")/2-this.get("height")*i/2)-this.getTextPadding("y")),this.textObject.set("left",a),this.textObject.set("top",n)},_wrapText:function(t,e){var i=this.originalScales?this.originalScales[0]:this.scaleX,a=this.width*i,n=e.split("\n"),o=[],s=0;this._setTextStyles(t);for(var l=0;l<n.length;l++){for(var r="",c=n[l].split(" "),h=0;h<c.length;h++){var g=r+c[h]+" ",f=t.measureText(g),d=f.width;d>a-2*this.getTextPadding("x")?(o.push(r),r=c[h]+" "):(r=g,s=Math.max(d,s))}o.push(r)}return o.join("\n")},_setTextStyles:function(t){t.fillStyle=this.fill.toLive?this.fill.toLive(t):this.fill,t.strokeStyle=this.strokeStyle,t.lineWidth=this.strokeWidth,t.textBaseline="alphabetic",t.textAlign=this.textAlign,t.font=this._getFontDeclaration()},_getFontDeclaration:function(){return[e.isLikelyNode?this.fontWeight:this.fontStyle,e.isLikelyNode?this.fontStyle:this.fontWeight,this.fontSize+"px",e.isLikelyNode?'"'+this.fontFamily+'"':this.fontFamily].join(" ")},_applyPropertiesToText:function(t){var i={};if(t)i=e.util.object.clone(t);else for(var a=0;a<n.length;a++)i[n[a]]=this.get(n[a]);return i.lockScalingX=!0,i.lockScalingY=!0,i.selectable=!1,i.scaleX=1,i.scaleY=1,i.text=this.originalText,this.textObject&&this.textObject.setOptions(i),i},_moveImageBox:function(t){var e=this.get("left")+this.get("width")/2,i=this.get("top");this.boxImage.left=e-this.get("width")/2,this.boxImage.top=i,this.boxImage.angle=this.get("angle");var a=this.get("width")*this.get("scaleX"),n=this.get("height")*this.get("scaleY"),o=a/this.boxImage.width,s=n/this.boxImage.height;this.boxImage.scaleX=o,this.boxImage.scaleY=s,this.boxImageScaleX=o,this.boxImageScaleY=s}}),e.Textbox.fromObject=function(t){var a=new e.Textbox(t.originalText,i(t),function(){return a&&a.canvas&&a.canvas.renderAll()});return a}}("undefined"!=typeof exports?exports:this);