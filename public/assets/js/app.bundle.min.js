function generate(){fabric.Object.prototype.transparentCorners=!1,fabric.Image.fromURL("./img/bg.png",function(t){t.scale(1).set({left:0,top:0}),canvas.add(t),fabric.Image.fromURL($("#preview").attr("src"),function(t){t.scale(1).set({left:10,top:90,width:360,height:360});var e=new fabric.Image.filters.Grayscale;t.filters.push(e),t.applyFilters(canvas.renderAll.bind(canvas)),canvas.add(t);var i=new fabric.Rect({left:10,top:86,width:360,height:365});i.setGradient("fill",{type:"linear",x1:0,y1:-360,x2:360,y2:-360,colorStops:{0:"rgba(255,255,255,0)",1:"rgba(255,255,255,0.8)"}}),canvas.add(i),fabric.Image.fromURL("./img/fg.png",function(t){t.scale(1).set({left:0,top:0}),canvas.add(t);var e=""!=$("#userName").val()?$("#userName").val():"Facebook User",i=""!=$("#userTitle").val()?$("#userTitle").val():"Duterte Supporter",a=new fabric.Textbox(e,{left:260,top:360,fontSize:20,fontFamily:"Raleway",textAlign:"center",vAlign:"center",fontWeight:600,width:260,height:58,fill:"#343434"}),s=new fabric.Textbox(i,{left:260,top:380,fontSize:15,fontFamily:"Raleway",textAlign:"center",vAlign:"center",fontWeight:400,width:260,height:58,fontStyle:"italic"});canvas.add(a),canvas.add(s);var n=canvas.toDataURL({format:"jpeg"});$("#output").attr("src",n).parent().attr("href",n)})})})}var canvas=this.__canvas=new fabric.StaticCanvas("c");$(document).ready(function(){$("#file").on("change",function(){var t=new FileReader;t.onload=function(t){document.getElementById("preview").src=t.target.result,generate()},t.readAsDataURL(this.files[0])}),$("#generate").click(function(){generate()}),$("#pickImage").click(function(t){t.preventDefault(),$("input[type=file]").trigger("click")})}),function(t){"use strict";var e=t.fabric||(t.fabric={}),i=(e.util.object.extend,e.util.object.clone);e.util.toFixed;if(e.Textbox)return void e.warn("fabric.Textbox is already defined");if(!e.Object)return void e.warn("fabric.Textbox requires fabric.Object");var a=e.Object.prototype.stateProperties.concat(),s=["fontFamily","fontWeight","fontSize","path","text","textDecoration","textShadow","textAlign","fontStyle","lineHeight","backgroundColor","textBackgroundColor","useNative","originalText","textPadding","boxPath","vAlign","boxImageScaleX","boxImageScaleY"];a=a.concat(s),e.Textbox=e.util.createClass(e.Object,{type:"textbox",fontSize:40,fontWeight:"normal",fontFamily:"Times New Roman",textDecoration:"",textShadow:"",textAlign:"left",fontStyle:"",lineHeight:1.3,backgroundColor:"",textBackgroundColor:"",path:null,useNative:!0,stateProperties:a,originalText:"",textPadding:10,scaleTextPadding:!0,boxImage:null,boxPath:"",vAlign:"center",originalScales:null,boxImageScaleX:1,boxImageScaleY:1,textObject:null,fill:"rgba(221,204,197,0.6)",initialize:function(t,a,s){this.callSuper("initialize",a),this.setOptions(a),this.setCoords(),this.originalText=t;var n=this,o=function(a,s){var o={};if(a.length>1){var l=i(s);o=new e.PathGroup(a,l)}else o="[object Array]"===Object.prototype.toString.call(a)?a[0]:a;var h=n.get("width")/o.get("width"),c=(n.get("height")+20)/o.get("height");n.boxImageScaleX=h,n.boxImageScaleY=c,o.set({angle:0,scaleX:h,scaleY:c,hasRotatingPoint:!1,lockScalingX:!0,lockScalingY:!0,selectable:!1,useNative:!0}),o.setSourcePath(n.boxPath),o.set("_id",n._id),n.boxImage=o,r(t,s)},r=function(t,i){n.textObject=new e.Text(t,i),n.textObject.originalText=t,n._applyPropertiesToText(i),s&&s()};this.boxPath?this.boxPath.match(/svg$/)?e.loadSVGFromURL(this.boxPath,o):e.Image.fromURL(this.boxPath,o):r(t,a)},toObject:function(t){return t||(t=[]),t=t.concat(s),e.util.object.extend(this.callSuper("toObject",t))},toggle:function(t){return this.boxImage.toggle(prop),this.callSuper("toggle",prop)},getTextPadding:function(t){if(t=t?t.toLowerCase():"x",this.boxImage&&this.scaleTextPadding){var e={},i=this.originalScales;return i?(e.x=i[0],e.y=i[1]):(e.x=this.get("scaleX"),e.y=this.get("scaleY")),this.textPadding*e[t]}return this.textPadding},render:function(t,e){0!==this.width&&0!==this.height&&(t.save(),this._preRenderTransform(t,e,!1),this._render(t,e),this.active&&!e&&(this.drawBorders(t),this.drawControls(t)),t.restore(),this.boxImage&&(this._moveImageBox(t),this.boxImage.render(t,!0)),this.textObject&&(t.save(),this._preRenderTransform(t,e,!0),this._applyPropertiesToText(),this._moveText(t),this.textObject.render(t,!0),e||(this.scaleX=this.originalScales[0],this.scaleY=this.originalScales[1],this.originalScales=null),t.restore()))},_preRenderTransform:function(t,e,i){var a=this.transformMatrix;a&&!this.group&&t.setTransform(a[0],a[1],a[2],a[3],a[4],a[5]),e||(i&&(this.originalScales=[this.scaleX,this.scaleY],this.scaleX=1,this.scaleY=1),this.transform(t)),a&&this.group&&(t.translate(-this.group.width/2,-this.group.height/2),t.transform(a[0],a[1],a[2],a[3],a[4],a[5]))},_render:function(t){if(this.isActive()&&!this.boxImage){t.save();var e=-this.width/2,i=-this.height/2,a=this.width,s=this.height;t.fillStyle=this.fill.toLive?this.fill.toLive(t):this.fill,t.fillRect(e,i,a,s),t.restore()}},_moveText:function(t){this.textObject.set("text",this._wrapText(t,this.textObject.get("originalText")));var e=this.originalScales?this.originalScales[0]:this.scaleX,i=this.originalScales?this.originalScales[1]:this.scaleY,a=0,s=0;"left"==this.textAlign?a=a-this.get("width")*e/2+this.textObject.get("width")/2+this.getTextPadding("x"):"right"==this.textAlign&&(a=a+this.get("width")*e/2-this.textObject.get("width")/2-this.getTextPadding("x")),"top"==this.vAlign?s=s+(this.textObject.get("height")/2-this.get("height")*i/2)+this.getTextPadding("y"):"bottom"==this.vAlign&&(s=s-(this.textObject.get("height")/2-this.get("height")*i/2)-this.getTextPadding("y")),this.textObject.set("left",a),this.textObject.set("top",s)},_wrapText:function(t,e){var i=this.originalScales?this.originalScales[0]:this.scaleX,a=this.width*i,s=e.split("\n"),n=[],o=0;this._setTextStyles(t);for(var r=0;r<s.length;r++){for(var l="",h=s[r].split(" "),c=0;c<h.length;c++){var g=l+h[c]+" ",x=t.measureText(g),f=x.width;f>a-2*this.getTextPadding("x")?(n.push(l),l=h[c]+" "):(l=g,o=Math.max(f,o))}n.push(l)}return n.join("\n")},_setTextStyles:function(t){t.fillStyle=this.fill.toLive?this.fill.toLive(t):this.fill,t.strokeStyle=this.strokeStyle,t.lineWidth=this.strokeWidth,t.textBaseline="alphabetic",t.textAlign=this.textAlign,t.font=this._getFontDeclaration()},_getFontDeclaration:function(){return[e.isLikelyNode?this.fontWeight:this.fontStyle,e.isLikelyNode?this.fontStyle:this.fontWeight,this.fontSize+"px",e.isLikelyNode?'"'+this.fontFamily+'"':this.fontFamily].join(" ")},_applyPropertiesToText:function(t){var i={};if(t)i=e.util.object.clone(t);else for(var a=0;a<s.length;a++)i[s[a]]=this.get(s[a]);return i.lockScalingX=!0,i.lockScalingY=!0,i.selectable=!1,i.scaleX=1,i.scaleY=1,i.text=this.originalText,this.textObject&&this.textObject.setOptions(i),i},_moveImageBox:function(t){var e=this.get("left")+this.get("width")/2,i=this.get("top");this.boxImage.left=e-this.get("width")/2,this.boxImage.top=i,this.boxImage.angle=this.get("angle");var a=this.get("width")*this.get("scaleX"),s=this.get("height")*this.get("scaleY"),n=a/this.boxImage.width,o=s/this.boxImage.height;this.boxImage.scaleX=n,this.boxImage.scaleY=o,this.boxImageScaleX=n,this.boxImageScaleY=o}}),e.Textbox.fromObject=function(t){var a=new e.Textbox(t.originalText,i(t),function(){return a&&a.canvas&&a.canvas.renderAll()});return a}}("undefined"!=typeof exports?exports:this);